<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>3D Brain Viewer</title>
  <style>
    body { margin:0; overflow:hidden; font-family:Arial,sans-serif; background:#111; }
    header {
      position:absolute; top:0; left:0; width:100%;
      display:flex; justify-content:space-between; align-items:flex-start;
      padding:10px 20px; background:rgba(0,0,0,0.5); color:#fff; z-index:10;
      flex-direction: column;
    }
    h1 { margin:0; font-size:24px; }
    #license {
      align-self:flex-end;
      font-size:12px;
      color:#ddd;
      margin-top:5px;
      max-width:70%;
      text-align:right;
    }
    #license a { color:#00aaff; text-decoration:none; }
    #tooltip {
      position:absolute; pointer-events:none; padding:6px 8px;
      border-radius:6px; background:rgba(0,0,0,0.7); color:#fff; font-size:13px;
      transform: translate(-50%,-120%); white-space:nowrap; display:none;
    }
    #loader {
      position:absolute; left:50%; top:50%; transform:translate(-50%,-50%);
      color:#ddd; font-size:14px; background:rgba(0,0,0,0.5); padding:8px 12px; border-radius:6px;
    }
    canvas { display:block; }
  </style>
</head>
<body>
  <header>
    <h1>3D Brain Viewer</h1>
    <div id="license">
      "Brain Realistic FREE" by 
      <a href="https://skfb.ly/oOHxB" target="_blank">darklord3d</a> 
      is licensed under 
      <a href="http://creativecommons.org/licenses/by/4.0/" target="_blank">Creative Commons Attribution 4.0 (CC BY 4.0)</a>.
    </div>
  </header>

  <div id="tooltip"></div>
  <div id="loader">Loading brain model...</div>

  <script type="module">
    import * as THREE from 'https://unpkg.com/three@0.161.0/build/three.module.js';
    import { OrbitControls } from 'https://unpkg.com/three@0.161.0/examples/jsm/controls/OrbitControls.js';
    import { GLTFLoader } from 'https://unpkg.com/three@0.161.0/examples/jsm/loaders/GLTFLoader.js';
    import { DRACOLoader } from 'https://unpkg.com/three@0.161.0/examples/jsm/loaders/DRACOLoader.js';

    const container = document.body;
    const tooltip = document.getElementById('tooltip');
    const loaderEl = document.getElementById('loader');

    const scene = new THREE.Scene();
    scene.background = new THREE.Color(0x0a0a0a);

    const camera = new THREE.PerspectiveCamera(45, window.innerWidth / window.innerHeight, 0.1, 1000);
    camera.position.set(0, 0.9, 2.5);

    const renderer = new THREE.WebGLRenderer({ antialias: true });
    renderer.setSize(window.innerWidth, window.innerHeight);
    container.appendChild(renderer.domElement);

    const hemi = new THREE.HemisphereLight(0xffffff, 0x222222, 0.6);
    scene.add(hemi);
    const dir = new THREE.DirectionalLight(0xffffff, 0.9);
    dir.position.set(5, 5, 5);
    scene.add(dir);

    const controls = new OrbitControls(camera, renderer.domElement);
    controls.enableDamping = true;
    controls.dampingFactor = 0.07;

    const raycaster = new THREE.Raycaster();
    const mouse = new THREE.Vector2();

    const gltfLoader = new GLTFLoader();
    const dracoLoader = new DRACOLoader();
    dracoLoader.setDecoderPath('https://www.gstatic.com/draco/v1/decoders/');
    gltfLoader.setDRACOLoader(dracoLoader);

    const brainGroup = new THREE.Group();
    scene.add(brainGroup);

    const MODEL_URL = 'https://drive.google.com/uc?export=download&id=1zp5EQN2YI-I75WFOJAPgN7hCRTjVTc2P';

    gltfLoader.load(
      MODEL_URL,
      (gltf) => {
        loaderEl.style.display = 'none';
        brainGroup.add(gltf.scene);

        gltf.scene.traverse(c => {
          if (c.isMesh) {
            c.material = new THREE.MeshStandardMaterial({ color: 0xcccccc, metalness: 0.05, roughness: 0.7 });
            c.userData.regionName = c.name || 'Brain Region';
          }
        });

        const box = new THREE.Box3().setFromObject(gltf.scene);
        const size = box.getSize(new THREE.Vector3()).length();
        const center = box.getCenter(new THREE.Vector3());
        camera.position.copy(center).add(new THREE.Vector3(size * 0.6, size * 0.4, size * 1.2));
        controls.target.copy(center);
        controls.update();
      },
      (xhr) => {
        loaderEl.innerText = `Loading brain model... ${Math.round((xhr.loaded / xhr.total) * 100)}%`;
      },
      (err) => {
        loaderEl.innerText = 'Failed to load model. Check file path or link.';
        console.error(err);
      }
    );

    window.addEventListener('pointermove', e => {
      const rect = renderer.domElement.getBoundingClientRect();
      mouse.x = ((e.clientX - rect.left) / rect.width) * 2 - 1;
      mouse.y = -((e.clientY - rect.top) / rect.height) * 2 + 1;
      raycaster.setFromCamera(mouse, camera);
      const intersects = raycaster.intersectObjects(brainGroup.children, true);
      if (intersects.length > 0) {
        tooltip.style.left = `${e.clientX}px`;
        tooltip.style.top = `${e.clientY}px`;
        tooltip.style.display = 'block';
        tooltip.textContent = intersects[0].object.userData.regionName;
      } else tooltip.style.display = 'none';
    });

    window.addEventListener('resize', () => {
      camera.aspect = window.innerWidth / window.innerHeight;
      camera.updateProjectionMatrix();
      renderer.setSize(window.innerWidth, window.innerHeight);
    });

    function animate() {
      requestAnimationFrame(animate);
      controls.update();
      renderer.render(scene, camera);
    }
    animate();
  </script>
</body>
</html>